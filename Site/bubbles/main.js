function onDeviceReady(){navigator.splashscreen.hide();document.addEventListener("pause",pause,false);init()}function exitFromApp(){if(navigator.app){navigator.app.exitApp()}else if(navigator.device){navigator.device.exitApp()}}function initready(){console.log("Init called");init()}function init(){function e(e){if(e=="1"){navigator.app.exitApp()}}console.log("Beginning");stage=new createjs.Stage("demoCanvas");clickRippleContainer=new createjs.Container;particleImage=new Image;particleImage.src="img/particle_base.png";iconSheet.onload=handleiconSheetLoad;iconSheet.src="img/bubbleIcons.png";if(typeof Storage!=="undefined"){score=Number(localStorage.getItem("score"));if(score==null||isNaN(score)||score==0){score=0}speedMin=Number(localStorage.getItem("speedMin"));if(speedMin==null||isNaN(speedMin||speedMin==0)){speedMin=2}speedMax=Number(localStorage.getItem("speedMax"));if(speedMax==null||isNaN(speedMax)||speedMax==0){speedMax=4}popScoreMin=Number(localStorage.getItem("popScoreMin"));if(popScoreMin==null||isNaN(popScoreMin)||popScoreMin==0){popScoreMin=1}popScoreMax=Number(localStorage.getItem("popScoreMax"));if(popScoreMax==null||isNaN(popScoreMax)||popScoreMax==0){popScoreMax=1}ambientPop=Number(localStorage.getItem("ambientPop"));if(ambientPop==null||isNaN(ambientPop)||ambientPop==0){ambientPop=.1}bubbleRate=Number(localStorage.getItem("bubbleRate"));if(bubbleRate==null||isNaN(bubbleRate)||bubbleRate<=0){bubbleRate=10;currentNoBubbles=10}upgradeCountNumBubbles=localStorage.getItem("upgradeCountNumBubbles");if(upgradeCountNumBubbles==null){upgradeCountNumBubbles=[0,0,0,0,0,0]}else{upgradeCountNumBubbles=upgradeCountNumBubbles.split(",")}upgradeCountValBubbles=localStorage.getItem("upgradeCountValBubbles");if(upgradeCountValBubbles==null){upgradeCountValBubbles=[0,0,0,0,0,0]}else{upgradeCountValBubbles=upgradeCountValBubbles.split(",")}upgradeCountAmbtPop=localStorage.getItem("upgradeCountAmbtPop");if(upgradeCountAmbtPop==null){upgradeCountAmbtPop=[0,0,0,0,0,0]}else{upgradeCountAmbtPop=upgradeCountAmbtPop.split(",")}console.log("Local storage available, updating gameplay variables")}else{console.log("No saved values found, gameplay variables set to baseline")}console.log("score "+score);console.log("speed Min: "+speedMin+" | Max: "+speedMax);console.log("Value Min: "+popScoreMin+" | Max: "+popScoreMax);console.log("ambientPop "+ambientPop);console.log("bubbleRate "+bubbleRate);console.log("No bubbles "+currentNoBubbles);console.log("upgradeCountNumBubbles: "+upgradeCountNumBubbles);console.log("upgradeCountValBubbles: "+upgradeCountValBubbles);console.log("upgradeCountAmbtPop: "+upgradeCountAmbtPop);canvas.addEventListener("click",handleClick,false);startScreen()}function handleiconSheetLoad(){var e={images:[iconSheet],frames:{width:40,height:40},animations:{numberIcon:0,valueIcon:1,ambientIcon:2,lightningIcon:3,pop:[4,7]}};iconSpriteSheet=new createjs.SpriteSheet(e);icon1=new createjs.Sprite(iconSpriteSheet);icon1.gotoAndStop("numberIcon");icon2=icon1.clone();icon2.gotoAndStop("valueIcon");icon3=icon2.clone();icon3.gotoAndStop("ambientIcon");icon4=icon3.clone();icon4.gotoAndStop("lightningIcon");popAnimation=icon4.clone();makeLightBeams()}function makeLightBeams(){for(i=0;i<noLightBeams;i++){var e=new Image;e.src="img/lightBeam.png";var t=new createjs.Bitmap(e);lightBeam=lightContainer.addChild(t);lightBeam.x=Math.random()*(canvas.width/(noLightBeams*2))+i*(canvas.width/noLightBeams)-200;lightBeam.y=-100;lightBeam.alpha=Math.random();lightBeam.speed=Math.random()*1.5+.5;lightBeam.name="lightbeam";lightBeam.rotation=figureRotation(lightBeam.x);lightBeam.direction=i%2;lightBeamList.push(lightBeam)}stage.addChild(lightContainer)}function moveLightBeams(){for(i=0;i<noLightBeams;i++){var e=lightBeamList[i];e.x+=e.direction*e.speed;if(e.x<-400||e.x>canvas.width+100){e.direction=e.direction*-1}lightBeam.rotation=figureRotation(lightBeam.x)}}function figureRotation(e){var t=e+canvas.width/2;returnValue=e*t/2e4*-1;return returnValue-20}function makeUpgradeBar(){function s(e,t,n,r){e.name=n;var i=40;var s=46;var o=t;var u=canvas.height-(i+5);var a=new createjs.Shape;a.graphics.beginFill("rgba(0,0,0,0.5)").drawCircle(o,u+i/2,s/2);e.addChild(a);r.x=t-20;r.y=u;e.addChild(r)}function l(e,t,n,r){f[e]=new createjs.Container;var i=theTop+e*55;f[e].name="number";f[e].inc=e;f[e].upgradeValue=t;f[e].upgradeCost=n;f[e].upgradeCount=upgradeCountNumBubbles[e];f[e].maxUpgradeCount=r;makeUpgrade(f[e],t+" bubbles",i);numBubblesPanel.addChild(f[e])}function v(e,t,n,r){d[e]=new createjs.Container;var i=theTop+e*55;d[e].name="value";d[e].inc=e;d[e].upgradeValue=t;d[e].upgradeCost=n;d[e].upgradeCount=upgradeCountValBubbles[e];d[e].maxUpgradeCount=r;makeUpgrade(d[e],"+$"+t,i);bubbleValuePanel.addChild(d[e])}function w(e,t,n,r){b[e]=new createjs.Container;var i=theTop+e*55;b[e].name="ambient";b[e].inc=e;b[e].upgradeValue=t;b[e].upgradeCost=n;b[e].upgradeCount=upgradeCountAmbtPop[e];b[e].maxUpgradeCount=r;makeUpgrade(b[e],"+"+t+"/sec",i);ambientPopPanel.addChild(b[e])}stage.addChild(upgradeBarContainer);var e=new createjs.Shape;e.graphics.beginFill("rgba(0,0,0,0.1)").rect(0,canvas.height-50,canvas.width,canvas.height);upgradeBarContainer.addChild(e);var t=new createjs.Container;s(t,canvas.width*.2,"Number of bubbles",icon1);var n=new createjs.Container;s(n,canvas.width*.4,"Value of bubbles",icon2);var r=new createjs.Container;s(r,canvas.width*.6,"Ambient pop rate",icon3);var i=new createjs.Container;s(i,canvas.width*.8,"Speed",icon4);upgradeBarContainer.addChild(t);upgradeBarContainer.addChild(n);upgradeBarContainer.addChild(r);upgradeBarContainer.addChild(i);var o=new createjs.Shape;o.name="panelBG";var u=new createjs.Text("Number of bubbles: "+bubbleRate,"20px Patrick Hand","#fff");u.name="numBubblesPanelTitle";var a=new createjs.Container;genericBits(numBubblesPanel,o,u,a);var f=[];l(0,-10,4e3,5);l(1,-5,200,10);l(2,-1,25,20);l(3,1,25,20);l(4,5,200,10);if(canvas.height>=490){l(5,10,4e3,5)}var c=new createjs.Shape;c.name="panelBG";var h=new createjs.Text("Value of bubbles ( around: $"+(popScoreMin+popScoreMax)/2+" )","20px Patrick Hand","#fff");h.name="bubbleValuePanelTitle";var p=new createjs.Container;genericBits(bubbleValuePanel,c,h,p);var d=[];v(0,2,100,5);v(1,10,3e3,5);v(2,100,68e3,5);v(3,1e3,13e5,5);v(4,1e4,2e7,5);if(canvas.height>=490){v(5,1e5,273e6,5)}var m=new createjs.Shape;m.name="panelBG";var g=new createjs.Text("Ambient pop rate: "+Math.round(ambientPop*10)/10+"/sec","20px Patrick Hand","#fff");g.name="ambientPopPanelTitle";var y=new createjs.Container;genericBits(ambientPopPanel,m,g,y);var b=[];w(0,.1,40,50);w(1,.2,400,10);w(2,.5,1600,10);w(3,2.5,8e3,10);w(4,8,39e3,10);if(canvas.height>=490){w(5,16,156e3,1)}var E=new createjs.Shape;E.name="panelBG";var S=new createjs.Text("Take a breather!","20px Patrick Hand","#fff");S.name="pausePanelTitle";var x=new createjs.Container;genericBits(pausePanel,E,S,x);var T=[];T[0]=new createjs.Container;var N=theTop+0*55;T[0].name="speed";T[0].upgradeValue=.5;T[0].upgradeCost=40;T[0].upgradeCount=0;T[0].maxUpgradeCount=1e3;makePauseOpt(T[0],"Half bubble speed",N);pausePanel.addChild(T[0]);T[1]=new createjs.Container;var N=theTop+1*55;T[1].name="speed";T[1].upgradeValue=.25;T[1].upgradeCost=100;T[1].upgradeCount=0;T[1].maxUpgradeCount=1e3;makePauseOpt(T[1],"Quarter bubble speed",N);pausePanel.addChild(T[1]);T[2]=new createjs.Container;var N=theTop+2*55;T[2].name="speed";T[2].upgradeValue=.1;T[2].upgradeCost=1e3;T[2].upgradeCount=0;T[2].maxUpgradeCount=1e3;makePauseOpt(T[2],"1/10th bubble speed",N);pausePanel.addChild(T[2]);var C=new createjs.Shape;C.graphics.beginFill("rgba(0,0,0,0.2)").drawRoundRect(canvas.width/2-145,270,290,75,cRadius);C.name="ijmccallum";pausePanel.addChild(C);var k=new createjs.Text("By\n\n Iain J McCallum","20px Patrick Hand","#fff");k.textAlign="center";k.x=canvas.width/2;k.y=275;k.name="ijmccallum";pausePanel.addChild(k);var L=new createjs.Shape;L.graphics.beginFill("rgba(255,0,0,0.2)").drawRoundRect(canvas.width/2-145,350,290,50,cRadius);L.name="reset";pausePanel.addChild(L);var A=new createjs.Text("RESET","20px Patrick Hand","#fff");A.textAlign="center";A.x=canvas.width/2;A.y=360;A.name="reset";pausePanel.addChild(A);var O=new createjs.Shape;O.name="panelBG";var M=new createjs.Text("You can't do that, \n\nyou haven't popped enough.","20px Patrick Hand","#fff");M.name="moneyPanelTitle";var _=new createjs.Container;genericBits(moneyPanel,O,M,_);var D=new createjs.Text("What?  How dare you!\n\nNo one tells me I can't do anything!\n\n","20px Patrick Hand","red");D.textAlign="center";D.x=canvas.width/2;D.y=130;moneyPanel.addChild(D);var P=[];P[0]=new createjs.Container;var N=theTop+2*55;P[0].name="money";P[0].upgradeValue=0;P[0].upgradeCost=1;makePauseOpt(P[0],"Reset limits",N);moneyPanel.addChild(P[0]);P[1]=new createjs.Container;var N=theTop+3*55;P[1].name="money";P[1].upgradeValue=1e3;P[1].upgradeCost=2;makePauseOpt(P[1],"Add $1,000",N);moneyPanel.addChild(P[1]);P[2]=new createjs.Container;var N=theTop+4*55;P[2].name="money";P[2].upgradeValue=1e4;P[2].upgradeCost=4;makePauseOpt(P[2],"Add $10,000",N);moneyPanel.addChild(P[2]);P[3]=new createjs.Container;var N=theTop+5*55;P[3].name="money";P[3].upgradeValue=1e5;P[3].upgradeCost=8;makePauseOpt(P[3],"Add $100,000",N);moneyPanel.addChild(P[3]);if(canvas.height>=540){P[4]=new createjs.Container;var N=theTop+6*55;P[4].name="money";P[4].upgradeValue=1e6;P[4].upgradeCost=10;makePauseOpt(P[4],"Add $1,000,000",N);moneyPanel.addChild(P[4])}}function genericBits(e,t,n,r){var i=canvas.width/2-150;var s=50;var o=300;var u=canvas.height-120;t.graphics.beginFill("rgba(0,0,0,0.5)").drawRoundRect(i,s,o,u,cRadius);n.textAlign="center";n.x=canvas.width*.5;n.y=60;e.addChild(t);e.addChild(n);console.log("HEIGHT "+canvas.height);if(canvas.height>=640){r.name="play";var a=canvas.width/2-145;var f=canvas.height-125;var l=290;var c=50;var h=new createjs.Shape;h.graphics.beginFill("rgba(0,255,0,0.8)").drawRoundRect(a,f,l,c,cRadius);r.addChild(h);var p=new createjs.Text("Play","20px Patrick Hand","#fff");p.textAlign="center";p.x=canvas.width*.5;p.y=f+10;p.name="play";r.addChild(p);e.addChild(r)}}function makeUpgrade(e,t,n){var r=canvas.width/2-145;var i=n;var s=290;var o=50;var u=r+10;var a=canvas.width/2+135;var f=n+10;var l=new createjs.Shape;l.graphics.beginFill("rgba(216,255,255,0.9)").drawRoundRect(r,i,s,o,cRadius);e.addChild(l);var c=new createjs.Text("("+e.upgradeCount+"/"+e.maxUpgradeCount+")","20px Patrick Hand","#006600");c.textAlign="center";c.x=canvas.width/2;c.y=f;c.name="upgradeCountTxt";e.addChild(c);var h=new createjs.Text(t,"20px Patrick Hand","#006600");h.textAlign="left";h.x=u;h.y=f;e.addChild(h);var p=new createjs.Text("$"+e.upgradeCost,"20px Patrick Hand","#006600");p.textAlign="right";p.x=a;p.y=f;e.addChild(p)}function makePauseOpt(e,t,n){var r=canvas.width/2-145;var i=n;var s=290;var o=50;var u=r+10;var a=canvas.width/2+135;var f=n+10;var l=new createjs.Shape;l.graphics.beginFill("rgba(216,255,255,0.9)").drawRoundRect(r,i,s,o,cRadius);e.addChild(l);var c=new createjs.Text(t,"20px Patrick Hand","#006600");c.textAlign="left";c.x=u;c.y=f;e.addChild(c);if(t=="Share to quadrupal your points!"){}else{var h=new createjs.Text("$"+e.upgradeCost,"20px Patrick Hand","#006600");h.textAlign="right";h.x=a;h.y=f;e.addChild(h)}}function startGamePlay(){stage.addChild(bubbleContainer);for(var e=0;e<bubbleRate;e++){bitmap=bubbleContainer.addChild(new createjs.Shape);bitmap.name="tgt"+e;resetTgt(bitmap,e);bmpList.push(bitmap)}txt=new createjs.Text("Score","20px Patrick Hand","#baffac");txt.textBaseline="top";txt.text=score;txt.textAlign="center";txt.x=canvas.width/2;txt.y=20;stage.addChild(txt);createjs.Ticker.on("tick",tick)}function tick(e){if(!lonleyMessageonCanvas){moveLightBeams();if(play==true){setSpeed("time");var t=bmpList.length;for(var n=0;n<t;n++){var r=bmpList[n];if(r.y>r.rndWidth*-1){r.y-=r.speed}else{score=score-Math.round(r.score/2);resetTgt(r)}}}for(n=0;n<clickRippleArray.length;n++){var i=clickRippleArray[n].opacityState;clickRippleArray[n].alpha=i;i=i-.2;if(i<0){clickRippleContainer.removeChild(clickRippleArray[n]);clickRippleArray.splice(n,1)}else{clickRippleArray[n].opacityState=i}}for(n=0;n<scoreTextList.length;n++){var i=scoreTextList[n].opacityState;scoreTextList[n].alpha=i;i=i-.1;if(i<0){stage.removeChild(scoreTextList[n]);scoreTextList.splice(n,1)}else{scoreTextList[n].opacityState=i}}if(score>=0){txt.text="$"+score}else{var s=score*-1;txt.text="-$"+s}stage.update(e)}}function createNewBubbles(e){if(e>0){totalBubbles=bubbleRate+e;currentNoBubbles+=e;for(var t=bubbleRate;t<totalBubbles;t++){bitmap=bubbleContainer.addChild(new createjs.Shape);bitmap.name="tgt"+t;resetTgt(bitmap,t);bmpList.push(bitmap)}}else{console.log("BUBBLE LIST BEFORE: "+bmpList);for(t=0;t>e;t--){var n=bmpList[bmpList.length-1];bubbleContainer.removeChild(n);bmpList.pop()}console.log("BUBBLE LIST AFTER: "+bmpList)}}function resetTgt(e,t){if(webApp){var n=Math.floor(Math.random()*10+1);switch(n){case 1:pop0.play();break;case 2:pop1.play();break;case 3:pop2.play();break;case 4:pop3.play();break;case 5:pop4.play();break;case 6:pop5.play();break;case 7:pop6.play();break;case 8:pop7.play();break;case 9:pop8.play();break;case 10:pop9.play();break}}if(e.y<e.rndWidth*-1){console.log("Escapee!");var r=Math.round(e.score/2);var i=new createjs.Text("-$"+r,"40px Patrick Hand","#cc0000");i.x=e.x;i.y=20;i.textAlign="center";i.opacityState=1;stage.addChild(i);scoreTextList.push(i)}e.y=canvas.height+Math.random()*500;e.x=canvas.width*Math.random()|0;var s=Math.random()*(35-15)+15;var o=selectColour();e.graphics.clear().beginFill(o).drawCircle(0,0,s).beginFill("rgba(255,255,255,0.2)").drawCircle(-s/20,-s/20,s-s/10).beginFill("rgba(255,255,255,0.8)").drawCircle(-s/3,-s/2,s/8);e.rndWidth=s;e.speed=Math.random()*speedMax+speedMin;e.score=Math.floor(Math.random()*popScoreMax+popScoreMin);e.alpha=.7;mvTargets[t]=e}function selectColour(){randomSelection=Math.floor(Math.random()*10+1);switch(randomSelection){case 1:return"#fefce9";break;case 2:return"#b1737e";break;case 3:return"#ccc9d9";break;case 4:return"#887769";break;case 5:return"#f26460";break;case 6:return"#9883a9";break;case 7:return"#7b7cb0";break;case 8:return"#a9dcd5";break;case 9:return"#68566a";break;case 10:return"#942758";break}}function ambientPopInit(){ambientTimer=setInterval(ambientPoppings,1e3/ambientPop)}function ambientPoppings(){if(state=="playing"){var e=false;var t,n;var r,s;var o=false;for(i=0;i<bmpList.length;i++){if(o){}else{t=Math.floor(Math.random()*bubbleRate);n=bmpList[t];if(n){if(n.y>0&&n.y<canvas.height-40){r=n.x;s=n.y;o=true;speedMax+=.005/ambientPop;speedMin+=.002/ambientPop;popBubble(n,r,s)}}}}}}function popBubble(e,t,n){createParticlePuff(t,n,e.rndWidth,e.score);score+=e.score;clicked=false;resetTgt(e);saveScore()}function createParticlePuff(e,t,n,r){var i=popAnimation.clone();var s=n/2;i.x=e-s;i.y=t-s;i.regX=s;i.regY=s;i.rotation=-50;var o=n/20;i.scaleX=o;i.scaleY=o;i.on("animationend",function(){this.stop();stage.removeChild(this)});stage.addChild(i);var u=new createjs.Text("+$"+r,"40px Patrick Hand","#baffac");u.x=e;u.y=t-n-20;u.textAlign="center";u.opacityState=1;stage.addChild(u);scoreTextList.push(u);i.gotoAndPlay("pop")}function setSpeed(e){function t(){function e(){activeSpeedMax=2;activeSpeedMin=1;speedMax=activeSpeedMax*.75;speedMin=activeSpeedMin*.75;for(var e=0;e<bmpList.length;e++){bmpList[e].speed=Math.random()*speedMax+speedMin}}feelingLonleyMessage("remove");if(speedMax==0){e()}if(activeSpeedMax<2||activeSpeedMin<1){e()}if(speedMax<activeSpeedMax){speedMax+=(activeSpeedMax-speedMax)/2;speedMin+=(activeSpeedMin-speedMin)/2}}if(e=="tgt"){speedMax+=.09;speedMin+=.045;t();if(speedMax>activeSpeedMax){activeSpeedMax=speedMax}if(speedMin>activeSpeedMin){activeSpeedMin=speedMin}}if(e=="time"){if(speedMax<=0){speedMax=0;speedMin=0;feelingLonleyMessage("add")}else if(speedMin<=0){speedMin=0;speedMax-=.004}else{speedMax-=.004;speedMin-=.002}}if(e=="blank"){if(speedMax>activeSpeedMax){activeSpeedMax=speedMax}if(speedMin>activeSpeedMin){activeSpeedMin=speedMin}t();clickRipple(stage.mouseX,stage.mouseY);if(vibration)navigator.vibrate(10)}}function feelingLonleyMessage(e){if(e=="add"&&!lonleyMessageonCanvas){lonleyMessage=new createjs.Text("Feeling lonley :(\n\n","20px Patrick Hand","#fff");lonleyMessage.text+="Tap me to wake up the bubbles";lonleyMessage.textAlign="center";lonleyMessage.x=canvas.width/2;lonleyMessage.y=canvas.height/3;lonleyMessageonCanvas=true;removePanels();stage.addChild(lonleyMessage);stage.update()}else if(e=="remove"&&lonleyMessageonCanvas){stage.removeChild(lonleyMessage);lonleyMessageonCanvas=false;stage.update()}}function handleClick(){canvas.onClick=null;mouseTarget=null;isClickHandeled=false;if(state=="start"){stage.removeChild(startTxt);makeUpgradeBar();startGamePlay();play=true;state="playing";ambientPopInit();stage.addChild(clickRippleContainer);isClickHandeled=true}if(stage.mouseX&&stage.mouseY){if(stage.mouseY>canvas.height-40){var e=canvas.width/5;if(stage.mouseX>e-20&&stage.mouseX<e+20){handlePanelBtn(numBubblesPanel);isClickHandeled=true}else if(stage.mouseX>e*2-20&&stage.mouseX<e*2+20){handlePanelBtn(bubbleValuePanel);isClickHandeled=true}else if(stage.mouseX>e*3-20&&stage.mouseX<e*3+20){handlePanelBtn(ambientPopPanel);isClickHandeled=true}else if(stage.mouseX>e*4-20&&stage.mouseX<e*4+20){handlePanelBtn(pausePanel);isClickHandeled=true}}else{mouseTarget=stage.getObjectUnderPoint(stage.mouseX,stage.mouseY);if(!mouseTarget){mouseTarget=stage.getObjectUnderPoint(stage.mouseX,stage.mouseY-40)}if(!mouseTarget){mouseTarget=stage.getObjectUnderPoint(stage.mouseX+20,stage.mouseY)}if(!mouseTarget){mouseTarget=stage.getObjectUnderPoint(stage.mouseX-20,stage.mouseY)}if(!mouseTarget){mouseTarget=stage.getObjectUnderPoint(stage.mouseX,stage.mouseY+20)}}if(mouseTarget){var t=String(mouseTarget.name);tgtCheck=t.substring(0,3);if(tgtCheck!=null&&tgtCheck=="tgt"&&state=="playing"){setSpeed("tgt");isClickHandeled=true;popBubble(mouseTarget,mouseTarget.x,mouseTarget.y)}else if(mouseTarget.name=="lightbeam"){setSpeed("blank");removePanels();playGame()}else if(mouseTarget.name=="ijmccallum"){window.open("http://iainjmccallum.com/","_system")}else if(mouseTarget.name=="reset"){var n=confirm("Really, start again?");if(n==true){upgradeCountNumBubbles=[0,0,0,0,0,0],upgradeCountValBubbles=[0,0,0,0,0,0],upgradeCountAmbtPop=[0,0,0,0,0,0];score=0,speedMin=2,speedMax=4,popScoreMin=1,popScoreMax=1,ambientPop=.1,bubbleRate=10;saveScore();location.reload()}}else if(mouseTarget.parent){var r=mouseTarget.parent.name;if(r=="number"||r=="value"||r=="ambient"||r=="speed"||r=="share"||r=="money"){handleUpgrade(mouseTarget.parent)}else if(mouseTarget.parent.name=="play"){removePanels();playGame()}else if(tgtCheck!=null&&tgtCheck=="tgt"&&state=="pause"){setSpeed("blank");removePanels();playGame()}else{setSpeed("blank")}}}else if(!isClickHandeled){removePanels();playGame();setSpeed("blank")}}}function handlePanelBtn(e){if(e.active){removePanels();playGame()}else{removePanels();stage.addChild(e);e.active=true;pause()}}function clickRipple(e,t){var n=new createjs.Shape;n.graphics.beginFill("rgba(255,255,255,0.2)").drawCircle(e,t,rippleWidth);n.name="clickRipple";n.opacityState=.75;clickRippleContainer.addChild(n);clickRippleArray.push(n)}function handleUpgrade(e){if(e.name=="money"){createPurchase(e.upgradeCost)}else{if(score<e.upgradeCost){handlePanelBtn(moneyPanel)}else{if(e.name=="number"){if(e.upgradeCount>=e.maxUpgradeCount){handlePanelBtn(moneyPanel)}else{createNewBubbles(e.upgradeValue);bubbleRate=bubbleRate+e.upgradeValue;e.upgradeCount++;upgradeCountNumBubbles[e.inc]=e.upgradeCount;e.getChildByName("upgradeCountTxt").text="("+e.upgradeCount+"/"+e.maxUpgradeCount+")";numBubblesPanel.getChildByName("numBubblesPanelTitle").text="Number of bubbles: "+bubbleRate;score=score-e.upgradeCost;console.log("Bubble rate: "+bubbleRate)}}else if(e.name=="value"){if(e.upgradeCount>=e.maxUpgradeCount){console.log("Hello google wallet again!");handlePanelBtn(moneyPanel)}else{popScoreMin=Math.round(popScoreMax+e.upgradeValue/2);popScoreMax=popScoreMax+e.upgradeValue;e.upgradeCount++;upgradeCountValBubbles[e.inc]=e.upgradeCount;e.getChildByName("upgradeCountTxt").text="("+e.upgradeCount+"/"+e.maxUpgradeCount+")";bubbleValuePanel.getChildByName("bubbleValuePanelTitle").text="Value of bubbles ( around: $"+(popScoreMin+popScoreMax)/2+" )";score=score-e.upgradeCost;console.log("Upgraded value, max: "+popScoreMax+" | min : "+popScoreMin)}}else if(e.name=="ambient"){if(e.upgradeCount>=e.maxUpgradeCount){console.log("Hello google wallet again!");handlePanelBtn(moneyPanel)}else{ambientPop=ambientPop+e.upgradeValue;e.upgradeCount++;upgradeCountAmbtPop[e.inc]=e.upgradeCount;e.getChildByName("upgradeCountTxt").text="("+e.upgradeCount+"/"+e.maxUpgradeCount+")";ambientPopPanel.getChildByName("ambientPopPanelTitle").text="Ambient pop rate: "+Math.round(ambientPop*10)/10+"/sec";score=score-e.upgradeCost;clearInterval(ambientTimer);ambientTimer=setInterval(ambientPoppings,1e3/ambientPop);console.log("Ambient pop rate: "+ambientPop)}}else if(e.name=="speed"){speedMin=Math.round(speedMin*e.upgradeValue);speedMax=Math.round(speedMax*e.upgradeValue);activeSpeedMax=speedMax;activeSpeedMin=speedMin;e.upgradeCount++;for(var t=0;t<noTgts;t++){var n=bmpList[t];n.speed=Math.round(n.speed*e.upgradeValue)}score=score-e.upgradeCost;console.log("Upgraded speed, max: "+speedMax+" | min : "+speedMin)}else if(e.name=="share"){console.log("Share code");score=score*4}}}saveScore();stage.update()}function startScreen(){state="start";startTxt=new createjs.Text("BUBBLES!\n\n","18px Patrick Hand","#fff");var e=Math.floor(Math.random()*10+1);switch(e){case 1:startTxt.text+="To overcome the bubbles\n\n";startTxt.text+="You must become the bubbles\n\n";break;case 2:startTxt.text+="These are not the bubbles \n\nyou need, to deserve... to need\n\n";startTxt.text+="These are the deservers that\n\n bubbles need...to bubble.\n\n";break;case 3:startTxt.text+="Bubble by bubble,\n\n";startTxt.text+="pop goes the weasel.\n\n";break;case 4:startTxt.text+="Better to have popped a bubble,\n\n";startTxt.text+="than to never have popped at all.\n\n";break;case 5:startTxt.text+="Popping bubbles is human,\n\n";startTxt.text+="Popping all the bubbles... divine.\n\n";break;case 6:startTxt.text+="A bubble under the thumb,\n\n";startTxt.text+="Is worth two on the run.\n\n";break;case 7:startTxt.text+="Whether you think\n\n you can pop,\n\n";startTxt.text+="or think you can not\n\n – you are right.\n\n";break;case 8:startTxt.text+="A bubble popped,\n\n";startTxt.text+="is a bubble earned.\n\n";break;case 9:startTxt.text+="Insanity:\n\n doing the same thing\n\n over and over again\n\n";startTxt.text+="and expecting\n\n different results.\n\n";break;case 10:startTxt.text+="Ask not\n\n what your bubbles\n\n can do for you;\n\n";startTxt.text+="ask what you can do\n\n for your bubbles.\n\n";break;default:break}startTxt.text+="Click to play!";startTxt.textAlign="center";startTxt.x=canvas.width/2;startTxt.y=canvas.height/3;stage.addChild(startTxt);stage.update()}function playPGAudio(e){var t=new Media("url",function(){console.log("playAudio():Audio Success")},function(e){console.log("playAudio():Audio Error: "+e)});t.play()}function getPhoneGapPath(){var e=window.location.pathname;e=e.substr(e,e.length-10);return"file://"+e}function createPurchase(e){walletWrap.style.display="block";$.ajax({url:"http://iainjmccallum.com/webServices/bubblesToken.php",type:"post",data:{buyValueToSend:e},dataType:"json",crossDomain:"true",contentType:"text/plain",success:function(e,t){console.log("AJAX DATA: "+e);console.log("AJAX STATUS: "+t);walletFeedback.innerHTML="Game server online! Connecting Google";helloGoogle(e)},error:function(e,t,n){walletFeedback.innerHTML="Couldn't connect to the server, here's the error I'm getting:<br />err: "+n+"<br />desc: "+t+"<br />xhr: "+JSON.stringify(e);spinner.style.display="none";walletButton.innerHTML="Well, this is awkward - You could either let Iain (the developer) know or you could just keep popping!  Up to you.";walletButton.style.display="block";console.log("AJAX ERROR XHR: "+e);console.log("AJAX ERROR DESC: "+t);console.log("AJAX ERROR ERR: "+n)}})}function helloGoogle(e){console.log("Calling google!");google.payments.inapp.buy({jwt:e,success:yeayGoogle,failure:awwGoogle})}function clearLimits(e){var t=e.getNumChildren();for(i=0;i<t;i++){var n=e.getChildAt(i);if(n.upgradeCount){n.upgradeCount=0;n.getChildByName("upgradeCountTxt").text="("+n.upgradeCount+"/"+n.maxUpgradeCount+")"}}}function walletBtnClick(){walletWrap.style.display="none";walletConnectionMsg.style.display="block";spinner.style.display="block";walletButton.style.display="none";walletFeedback.innerHTML="Connecting to game server..."}function removePanels(){numBubblesPanel.active=false;bubbleValuePanel.active=false;ambientPopPanel.active=false;pausePanel.active=false;moneyPanel.active=false;if(stage.contains(numBubblesPanel)){stage.removeChild(numBubblesPanel)}if(stage.contains(bubbleValuePanel)){stage.removeChild(bubbleValuePanel)}if(stage.contains(ambientPopPanel)){stage.removeChild(ambientPopPanel)}if(stage.contains(pausePanel)){stage.removeChild(pausePanel)}if(stage.contains(moneyPanel)){stage.removeChild(moneyPanel)}}function pause(){play=false;state="pause";clearInterval(ambientTimer)}function playGame(){play=true;state="playing";clearInterval(ambientTimer);ambientTimer=setInterval(ambientPoppings,1e3/ambientPop)}function saveScore(){if(typeof Storage!=="undefined"){localStorage.setItem("score",score);localStorage.setItem("speedMin",speedMin);localStorage.setItem("speedMax",speedMax);localStorage.setItem("popScoreMin",popScoreMin);localStorage.setItem("popScoreMax",popScoreMax);localStorage.setItem("ambientPop",ambientPop);localStorage.setItem("bubbleRate",bubbleRate);localStorage.setItem("upgradeCountNumBubbles",upgradeCountNumBubbles);localStorage.setItem("upgradeCountValBubbles",upgradeCountValBubbles);localStorage.setItem("upgradeCountAmbtPop",upgradeCountAmbtPop);upgradeCountAmbtPop}else{console.log("No local storage available, can't save score :(")}}var webApp=true;if(webApp){var pop0=new Audio("sound/pop0.wav"),pop1=new Audio("sound/pop1.wav"),pop2=new Audio("sound/pop2.wav"),pop3=new Audio("sound/pop3.wav"),pop4=new Audio("sound/pop4.wav"),pop5=new Audio("sound/pop5.wav"),pop6=new Audio("sound/pop6.wav"),pop7=new Audio("sound/pop7.wav"),pop8=new Audio("sound/pop8.wav"),pop9=new Audio("sound/pop9.wav")}var score=0,speedMin=2,speedMax=4,popScoreMin=1,popScoreMax=1,ambientPop=.1,bubbleRate=10,currentNoBubbles=10;var upgradeCountNumBubbles=[0,0,0,0,0,0],upgradeCountValBubbles=[0,0,0,0,0,0],upgradeCountAmbtPop=[0,0,0,0,0,0];var ambientTimer;var clickRippleContainer,totalClickRipples,rippleWidth=20,clickRippleArray=[];var numBubblesPanel=new createjs.Container,bubbleValuePanel=new createjs.Container,ambientPopPanel=new createjs.Container,pausePanel=new createjs.Container,moneyPanel=new createjs.Container;numBubblesPanel.active=false;bubbleValuePanel.active=false;ambientPopPanel.active=false;var theTop=100;var cRadius=5;var iconSheet=new Image,iconSpriteSheet,icon1,icon2,icon3,icon4;var stage,circle,target,circleY,score,bitmap,txt,play,pauseTxt,clicked,mouseTarget,mvTargets=[],state=[],startTxt;var canvas=document.getElementById("demoCanvas");FastClick.attach(canvas);var noTgts=5;var tgtBlurFilter=[];var particleImage,particleBmp;var puff=[],emitter=[],emitterAlive=[];var emitterCount=0;var bubbleContainer=new createjs.Container;var upgradeBarContainer=new createjs.Container;var bmpList=[];navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.moz||navigator.notification.vibrate||window.navigator.vibrate;var vibration=false;if(navigator.vibrate){vibration=true}document.addEventListener("deviceready",onDeviceReady,false);document.getElementById("demoCanvas").width=window.innerWidth;document.getElementById("demoCanvas").height=window.innerHeight;document.getElementById("walletLoaderWrap").style.width=window.innerWidth+"px";document.getElementById("walletLoaderWrap").style.height=window.innerHeight+"px";var popAnimation;var lightBeamList=[];var lightContainer=new createjs.Container;var noLightBeams=10;6.5*42e3/365;var scoreTextList=[];var activeSpeedMax=speedMax,activeSpeedMin=speedMin;var lonleyMessage;lonleyMessageonCanvas=false;var jwtToBuy;var walletWrap=document.getElementById("walletLoaderWrap");var walletFeedback=document.getElementById("walletLoaderMessage");var walletButton=document.getElementById("closeWallet");var walletConnectionMsg=document.getElementById("connectMessage");var spinner=document.getElementById("walletSpinner");var yeayGoogle=function(e){if(window.console!=undefined){console.log("Purchase completed successfully: "+e);console.log("Purchase stringified: "+JSON.stringify(e));walletConnectionMsg.style.display="none";walletFeedback.innerHTML="Ok FINE, there you go.";spinner.style.display="none";walletButton.innerHTML="Let's put this behind us and get back to popping.";walletButton.style.display="block";var t=e.request.price;switch(t){case"1":clearLimits(numBubblesPanel);clearLimits(bubbleValuePanel);clearLimits(ambientPopPanel);upgradeCountNumBubbles=[0,0,0,0,0,0];upgradeCountValBubbles=[0,0,0,0,0,0];upgradeCountAmbtPop=[0,0,0,0,0,0];break;case"2":console.log("add 1,000 points");score+=1e3;break;case"4":console.log("add 10,000 points");score+=1e4;break;case"8":console.log("add 100,000 points");score+=1e5;break;case"10":console.log("add 1,000,000 points");score+=1e6;break}}};var awwGoogle=function(e){if(window.console!=undefined){console.log("Purchase did not complete: "+JSON.stringify(e));walletFeedback.innerHTML="HAHA! Yes my friend, well done - for resisting the temptation of cheating I shall gift you 1 point. Now go on your way and pop your bubbles, I forbid you to even dare think of cheating again. Go my minion! Go pop pop poppety pop!";spinner.style.display="none";walletConnectionMsg.style.display="none";walletButton.innerHTML="Right, now that's over, let's get back to popping.";walletButton.style.display="block";console.log("NUM: "+JSON.stringify(upgradeCountNumBubbles));score+=1}}